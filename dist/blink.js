!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(r(5)).default.config();class s extends Error{constructor(e){super(e),this.name="ConfigNotSetError"}}t.default=class{static getRequiredConfig(e){if(process.env[e])return process.env[e];throw new s(e)}static getOptionalConfig(e,t){try{return this.getRequiredConfig(e)}catch(e){if("ConfigNotSetError"===e.name&&t)return t;throw e}}static get PUSHER_APPID(){return this.getRequiredConfig("PUSHER_APPID")}static get PUSHER_KEY(){return this.getRequiredConfig("PUSHER_KEY")}static get PUSHER_SECRET(){return this.getRequiredConfig("PUSHER_SECRET")}static get PUSHER_CLUSTER(){return this.getRequiredConfig("PUSHER_CLUSTER")}static get PUSHER_BLINK_CHANNEL(){return this.getOptionalConfig("PUSHER_CHANNEL","blink")}static get PORT(){return parseInt(this.getOptionalConfig("PORT","5000"))}static get PASSWORD_HASH(){return this.getRequiredConfig("PASSWORD_HASH")}static get JWT_SECRET(){return this.getRequiredConfig("JWT_SECRET")}static get BLINK_TIMEOUT(){return parseInt(this.getOptionalConfig("BLINK_TIMEOUT","30"))}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(6)),i=n(r(7)),u=n(r(8)),o=n(r(0)),c=n(r(2)),a=n(r(9));t.default=class{static createPusherClient(){return new u.default(o.default.PUSHER_KEY,{cluster:o.default.PUSHER_CLUSTER,encrypted:!0})}static createPusherServer(){return new i.default({appId:o.default.PUSHER_APPID,key:o.default.PUSHER_KEY,secret:o.default.PUSHER_SECRET,useTLS:!0,cluster:o.default.PUSHER_CLUSTER})}static createBlink1(){return new s.default}static createMessageReceiver(){return new c.default}static createMessageSender(){return new a.default}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(0)),i=n(r(1));t.default=class{constructor(){this.pusher=i.default.createPusherClient(),this.channel=this.pusher.subscribe(s.default.PUSHER_BLINK_CHANNEL),this.pusher.connection.bind("error",e=>{console.error("Pusher: connection error",e)})}bind(e,t){this.channel.bind(e,t)}disconnect(){this.pusher.disconnect()}}},function(e,t){e.exports=require("lodash")},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(2)),i=n(r(10));(new class{constructor(){this.messageReceiver=new s.default,this.blink=new i.default}run(){this.messageReceiver.bind("blink",this.blink.processMessage.bind(this.blink))}}).run()},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("node-blink1")},function(e,t){e.exports=require("pusher")},function(e,t){e.exports=require("pusher-js")},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(0)),i=n(r(1));t.default=class{constructor(){this.pusherServer=i.default.createPusherServer()}trigger(e,t){this.pusherServer.trigger(s.default.PUSHER_BLINK_CHANNEL,e,t)}isSubscriberConnected(){return new Promise(e=>{this.pusherServer.get({path:`/channels/${s.default.PUSHER_BLINK_CHANNEL}`,params:{}},(t,r,n)=>{if(t)e(!1);else if(200===n.statusCode){const t=JSON.parse(n.body);e(t.occupied)}else e(!1)})})}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(3)),i=n(r(11)),u=r(12),o=n(r(0)),c=n(r(1));t.default=class{constructor(){this.handleTimeout=s.default.debounce(()=>{try{this.blink1.off()}catch(e){}},1e3*o.default.BLINK_TIMEOUT);try{this.blink1=c.default.createBlink1()}catch(e){console.error(e.message)}}processMessage(e){switch(e.type){case u.MessageType.BlinkOff:this.off();break;case u.MessageType.BlinkSetColor:this.setColor(e.color)}}close(){this.handleTimeout.cancel();try{this.blink1.close()}catch(e){}}off(){this.run(()=>{this.blink1.off()})}setColor(e){const t=i.default(e).toRgb();this.run(()=>{this.blink1.fadeToRGB(500,t.r,t.g,t.b)})}run(e){try{e()}catch(t){try{this.blink1=c.default.createBlink1(),e()}catch(e){console.error(e.message)}}this.handleTimeout()}}},function(e,t){e.exports=require("tinycolor2")},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(3));var i;!function(e){e[e.BlinkOff=0]="BlinkOff",e[e.BlinkSetColor=1]="BlinkSetColor"}(i=t.MessageType||(t.MessageType={}));t.BlinkOffMessage=class{constructor(){this.type=i.BlinkOff}};t.BlinkSetColorMessage=class{constructor(e){this.type=i.BlinkSetColor,this.color=e}},t.isValidMessage=function(e){if(!s.default.isObjectLike(e))return!1;switch(e.type){case i.BlinkOff:return!0;case i.BlinkSetColor:return function(e){return!!s.default.isString(e)&&/^#[0-9a-f]{6}$/i.test(e)}(e.color);default:return!1}}}]);
//# sourceMappingURL=blink.js.map