!function(e){var t={};function n(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)n.d(r,u,function(t){return e[t]}.bind(null,u));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),u(n(7)).default.config();var o=function(e){function t(t){var n=e.call(this,t)||this;return n.name="ConfigNotSetError",n}return r(t,e),t}(Error),i=function(){function e(){}return e.getRequiredConfig=function(e){if(process.env[e])return process.env[e];throw new o(e)},e.getOptionalConfig=function(e,t){try{return this.getRequiredConfig(e)}catch(e){if("ConfigNotSetError"===e.name&&t)return t;throw e}},Object.defineProperty(e,"PUSHER_APPID",{get:function(){return this.getRequiredConfig("PUSHER_APPID")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PUSHER_KEY",{get:function(){return this.getRequiredConfig("PUSHER_KEY")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PUSHER_SECRET",{get:function(){return this.getRequiredConfig("PUSHER_SECRET")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PUSHER_CLUSTER",{get:function(){return this.getRequiredConfig("PUSHER_CLUSTER")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PUSHER_BLINK_CHANNEL",{get:function(){return"blink"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PORT",{get:function(){return parseInt(this.getOptionalConfig("PORT","5000"))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PASSWORD_HASH",{get:function(){return this.getRequiredConfig("PASSWORD_HASH")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"JWT_SECRET",{get:function(){return this.getRequiredConfig("JWT_SECRET")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"BLINK_TIMEOUT",{get:function(){return parseInt(this.getOptionalConfig("BLINK_TIMEOUT","30"))},enumerable:!0,configurable:!0}),e}();t.default=i},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(n(9)),o=r(n(10)),i=r(n(11)),s=r(n(0)),c=r(n(12)),f=r(n(13)),a=function(){function e(){}return e.createPusherClient=function(){return new i.default(s.default.PUSHER_KEY,{cluster:s.default.PUSHER_CLUSTER,encrypted:!0})},e.createPusherServer=function(){return new o.default({appId:s.default.PUSHER_APPID,key:s.default.PUSHER_KEY,secret:s.default.PUSHER_SECRET,encrypted:!0,cluster:s.default.PUSHER_CLUSTER})},e.createBlink1=function(){return new u.default},e.createMessageReceiver=function(){return new c.default},e.createMessageSender=function(){return new f.default},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(n(4)),o=r(n(1)),i=r(n(5)),s=r(n(6)),c=r(n(0)),f=r(n(8)),a=r(n(16)),l=o.default();l.use(i.default("dev")),l.use(o.default.json()),l.use(u.default()),l.use("/",a.default),l.use(o.default.static(s.default.join("dist","www"))),l.use("/api",f.default),l.listen(c.default.PORT,function(){return console.log("Listening on port "+c.default.PORT)})},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(n(1)).default.Router(),o=r(n(2)),i=n(14),s=null;u.post("/blink",function(e,t,n){i.isValidMessage(e.body)?(s||(s=o.default.createMessageSender()),s.trigger("blink",e.body),t.send()):(t.status(400),t.send("Invalid message"))}),t.default=u},function(e,t){e.exports=require("node-blink1")},function(e,t){e.exports=require("pusher")},function(e,t){e.exports=require("pusher-js")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(n(0)),o=r(n(2)),i=function(){function e(){this.eventBindings=[],this.reconnectTimer=null,this.pusher=null,this.channel=null,this.connect()}return e.prototype.bind=function(e,t){this.eventBindings.push({eventName:e,callback:t}),this.channel.bind(e,t)},e.prototype.disconnect=function(){this.pusher.disconnect()},e.prototype.connect=function(){var e=this;this.pusher=o.default.createPusherClient(),this.channel=this.pusher.subscribe(u.default.PUSHER_BLINK_CHANNEL),this.pusher.connection.bind("error",function(e){console.error("Pusher: connection error",e)}),this.pusher.connection.bind("unavailable",function(){return e.reconnect()}),this.pusher.connection.bind("connected",function(){console.log("Pusher: connected"),e.reconnectTimer&&(clearInterval(e.reconnectTimer),e.reconnectTimer=null)})},e.prototype.reconnect=function(){console.warn("Pusher: unavailable, reconnecting"),this.reconnectTimer||(this.reconnectTimer=setInterval(function(){},6e4))},e}();t.default=i},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(n(0)),o=r(n(2)),i=function(){function e(){this.pusherServer=o.default.createPusherServer()}return e.prototype.trigger=function(e,t){this.pusherServer.trigger(u.default.PUSHER_BLINK_CHANNEL,e,t)},e.prototype.subscriberConnected=function(e){this.pusherServer.get({path:"/channels/"+u.default.PUSHER_BLINK_CHANNEL,params:{}},function(t,n,r){if(t)e(!1);else if(200===r.statusCode){var u=JSON.parse(r.body);e(u.occupied)}else console.error(t),e(!1)})},e}();t.default=i},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u,o=r(n(15));!function(e){e[e.BlinkOff=0]="BlinkOff",e[e.BlinkSetColor=1]="BlinkSetColor"}(u=t.MessageType||(t.MessageType={}));var i=function(){return function(){this.type=u.BlinkOff}}();t.BlinkOffMessage=i;var s=function(){return function(e){this.type=u.BlinkSetColor,this.color=e}}();t.BlinkSetColorMessage=s,t.isValidMessage=function(e){if(!o.default.isObjectLike(e))return!1;switch(e.type){case u.BlinkOff:return!0;case u.BlinkSetColor:return function(e){return!!o.default.isString(e)&&/^#[0-9a-f]{6}$/i.test(e)}(e.color);default:return!1}}},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(n(1)),o=u.default.Router(),i=r(n(17)),s=r(n(18)),c=r(n(0)),f='\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>blink(1) web</title>\n  </head>\n  <body>\n    <h1>Login</h1>\n    <form method="POST">\n      <input name="password" type="password" placeholder="Password">\n      <button type="submit">Submit</button>\n    </form>\n  </body>\n</html>\n';o.post("/",u.default.urlencoded({extended:!0}),function(e,t,n){if(!e.body.password)return t.status(400),void t.send(f);i.default.compare(e.body.password,c.default.PASSWORD_HASH,function(e,n){if(n){var r=s.default.sign({},c.default.JWT_SECRET);t.cookie("jwt",r,{maxAge:864e7}),t.redirect("/")}else t.status(403),t.send(f)})}),o.all("*",function(e,t,n){var r=e.cookies.jwt;s.default.verify(r,c.default.JWT_SECRET,function(e,r){e?(t.status(403),t.send(f)):n()})}),t.default=o},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("jsonwebtoken")}]);
//# sourceMappingURL=server.js.map