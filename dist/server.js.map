{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/util/config.ts","webpack:///external \"express\"","webpack:///./src/util/factory.ts","webpack:///./src/server/server.ts","webpack:///external \"cookie-parser\"","webpack:///external \"morgan\"","webpack:///external \"path\"","webpack:///external \"dotenv\"","webpack:///./src/server/routes/api.ts","webpack:///external \"node-blink1\"","webpack:///external \"pusher\"","webpack:///external \"pusher-js\"","webpack:///./src/util/message-receiver.ts","webpack:///./src/util/message-sender.ts","webpack:///./src/util/sleep.ts","webpack:///./src/types/message.ts","webpack:///external \"lodash\"","webpack:///./src/server/routes/login.ts","webpack:///external \"bcrypt\"","webpack:///external \"jsonwebtoken\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__importDefault","default","config","ConfigNotSetError","Error","[object Object]","message","super","this","process","env","defaultValue","getRequiredConfig","e","PUSHER_APPID","PUSHER_KEY","PUSHER_SECRET","PUSHER_CLUSTER","PUSHER_BLINK_CHANNEL","getOptionalConfig","PORT","parseInt","PASSWORD_HASH","JWT_SECRET","BLINK_TIMEOUT","require","node_blink1_1","pusher_1","pusher_js_1","config_1","message_receiver_1","message_sender_1","cluster","encrypted","appId","secret","useTLS","cookie_parser_1","express_1","morgan_1","path_1","api_1","login_1","app","use","json","static","join","listen","console","log","router","Router","factory_1","sleep_1","message_1","getMessageSender","messageSender","createMessageSender","post","req","res","next","isValidMessage","body","trigger","send","status","__awaiter","isConnected","Promise","race","isSubscriberConnected","pusher","createPusherClient","channel","subscribe","connection","err","error","eventName","callback","disconnect","pusherServer","createPusherServer","data","resolve","path","params","statusCode","result","JSON","parse","occupied","ms","setTimeout","lodash_1","MessageType","BlinkOffMessage","type","BlinkOff","BlinkSetColorMessage","color","BlinkSetColor","isObjectLike","isString","test","isValidColor","bcrypt_1","jsonwebtoken_1","loginPage","urlencoded","extended","password","compare","same","token","sign","cookieOptions","maxAge","cookie","redirect","all","cookies","jwt","verify","decoded"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","import dotenv from 'dotenv';\ndotenv.config();\n\nclass ConfigNotSetError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'ConfigNotSetError';\n  }\n}\n\nexport default class Config {\n  private static getRequiredConfig(name: string): string {\n    if (process.env[name]) {\n      return process.env[name] as string;\n    } else {\n      throw new ConfigNotSetError(name);\n    }\n  }\n\n  private static getOptionalConfig(name: string, defaultValue?: string): string {\n    try {\n      return this.getRequiredConfig(name);\n    } catch (e) {\n      // Typescript 2.1 breaking change: instanceof Error subclass doesn't work\n      // if (e instanceof ConfigNotSetError && defaultValue) {\n      if (e.name === 'ConfigNotSetError' && defaultValue) {\n        return defaultValue;\n      }\n      throw e;\n    }\n  }\n\n  public static get PUSHER_APPID(): string { return this.getRequiredConfig('PUSHER_APPID'); }\n  public static get PUSHER_KEY(): string { return this.getRequiredConfig('PUSHER_KEY'); }\n  public static get PUSHER_SECRET(): string { return this.getRequiredConfig('PUSHER_SECRET'); }\n  public static get PUSHER_CLUSTER(): string { return this.getRequiredConfig('PUSHER_CLUSTER'); }\n  public static get PUSHER_BLINK_CHANNEL(): string { return this.getOptionalConfig('PUSHER_CHANNEL', 'blink'); }\n\n  public static get PORT(): number { return parseInt(this.getOptionalConfig('PORT', '5000')); }\n  public static get PASSWORD_HASH(): string { return this.getRequiredConfig('PASSWORD_HASH'); }\n  public static get JWT_SECRET(): string { return this.getRequiredConfig('JWT_SECRET'); }\n\n  public static get BLINK_TIMEOUT(): number { return parseInt(this.getOptionalConfig('BLINK_TIMEOUT', '30')); }\n}\n","module.exports = require(\"express\");","import Blink1 from 'node-blink1';\nimport PusherServer from 'pusher';\nimport PusherClient from 'pusher-js';\n\nimport Config from './config';\nimport MessageReceiver from './message-receiver';\nimport MessageSender from './message-sender';\n\n/* tslint:disable:member-ordering */\nexport default class Factory {\n  public static createPusherClient(): Pusher.Pusher {\n    return new PusherClient(Config.PUSHER_KEY, {\n      cluster: Config.PUSHER_CLUSTER,\n      encrypted: true,\n    });\n  }\n\n  public static createPusherServer(): PusherServer {\n    return new PusherServer({\n      appId: Config.PUSHER_APPID,\n      key: Config.PUSHER_KEY,\n      secret: Config.PUSHER_SECRET,\n      useTLS: true,\n      cluster: Config.PUSHER_CLUSTER,\n    });\n  }\n\n  public static createBlink1(): Blink1 {\n    return new Blink1();\n  }\n\n  public static createMessageReceiver(): MessageReceiver {\n    return new MessageReceiver();\n  }\n\n  public static createMessageSender(): MessageSender {\n    return new MessageSender();\n  }\n}\n","import cookieParser from 'cookie-parser';\nimport express from 'express';\nimport morgan from 'morgan';\nimport path from 'path';\n\nimport Config from '../util/config';\n\nimport api from './routes/api';\nimport login from './routes/login';\n\nconst app: express.Application = express();\n\napp.use(morgan('dev'));\napp.use(express.json());\napp.use(cookieParser());\n\napp.use('/', login);\n\n// frontend\napp.use(express.static(path.join('dist', 'www')));\n\napp.use('/api', api);\n\napp.listen(Config.PORT, () => console.log(`Listening on port ${ Config.PORT }`));\n","module.exports = require(\"cookie-parser\");","module.exports = require(\"morgan\");","module.exports = require(\"path\");","module.exports = require(\"dotenv\");","import express from 'express';\nconst router: express.Router = express.Router();\n\nimport Factory from '../../util/factory';\nimport sleep from '../../util/sleep';\n\nimport {\n  isValidMessage,\n  Message,\n  MessageType,\n} from '../../types/message';\n\nimport MessageSender from '../../util/message-sender';\nconst getMessageSender = (() => {\n  let messageSender: MessageSender | null = null;\n  return () => {\n    if (!messageSender) {\n      messageSender = Factory.createMessageSender();\n    }\n    return messageSender;\n  };\n})();\n\nrouter.post('/blink', (req: express.Request, res: express.Response, next: express.NextFunction) => {\n  if (isValidMessage(req.body)) {\n    getMessageSender().trigger('blink', req.body);\n    res.send();\n  } else {\n    res.status(400);\n    res.send('Invalid message');\n  }\n});\n\nrouter.get('/status', async (req: express.Request, res: express.Response, next: express.NextFunction) => {\n  const isConnected: boolean = await Promise.race([\n    getMessageSender().isSubscriberConnected(),\n    sleep(2000, false),\n  ]);\n\n  res.send({ isConnected });\n});\n\nexport default router;\n","module.exports = require(\"node-blink1\");","module.exports = require(\"pusher\");","module.exports = require(\"pusher-js\");","import Config from './config';\nimport Factory from './factory';\n\nexport default class MessageReceiver {\n  private pusher: Pusher.Pusher;\n  private channel: Pusher.Channel;\n\n  constructor() {\n    this.pusher = Factory.createPusherClient();\n    this.channel = this.pusher.subscribe(Config.PUSHER_BLINK_CHANNEL);\n\n    this.pusher.connection.bind('error', (err) => {\n      console.error('Pusher: connection error', err);\n    });\n  }\n\n  public bind(eventName: string, callback: Pusher.EventCallback): void {\n    this.channel.bind(eventName, callback);\n  }\n\n  public disconnect(): void {\n    this.pusher.disconnect();\n  }\n}\n","import PusherServer from 'pusher';\n\nimport Config from './config';\nimport Factory from './factory';\n\nexport default class MessageSender {\n  private pusherServer: PusherServer;\n\n  constructor() {\n    this.pusherServer = Factory.createPusherServer();\n  }\n\n  public trigger(eventName: string, data: any): void {\n    this.pusherServer.trigger(Config.PUSHER_BLINK_CHANNEL, eventName, data);\n  }\n\n  public isSubscriberConnected(): Promise<boolean> {\n    return new Promise((resolve) => {\n      this.pusherServer.get({\n        path: `/channels/${Config.PUSHER_BLINK_CHANNEL}`,\n        params: {},\n      }, (err, req, res) => {\n        if (err) {\n          resolve(false);\n        } else {\n          if (res.statusCode === 200) {\n            const result = JSON.parse(res.body);\n            resolve(result.occupied);\n          } else {\n            resolve(false);\n          }\n        }\n      });\n    });\n  }\n\n}\n","// resolve Promise in ms milliseconds with value result\nexport default function sleep<T> (ms: number, result?: T): Promise<T> {\n  return new Promise((resolve) => {\n    setTimeout(() => resolve(result), ms);\n  });\n}\n","import _ from 'lodash';\n\nexport enum MessageType {\n  BlinkOff,\n  BlinkSetColor,\n}\n\nexport interface Message {\n  type: MessageType;\n}\n\nexport class BlinkOffMessage implements Message {\n  public type = MessageType.BlinkOff;\n\n  constructor() { }\n}\n\nexport class BlinkSetColorMessage implements Message {\n  public type = MessageType.BlinkSetColor;\n  public color: string;\n\n  constructor(color: string) {\n    this.color = color;\n  }\n}\n\n// validate format\nfunction isValidColor(color: any): boolean {\n  if (!_.isString(color)) {\n    return false;\n  }\n  const colorRegex = /^#[0-9a-f]{6}$/i;\n  return colorRegex.test(color);\n}\nexport function isValidMessage(message: any): message is Message {\n  if (!_.isObjectLike(message)) {\n    return false;\n  }\n  switch (message.type) {\n    case MessageType.BlinkOff:\n      return true;\n    case MessageType.BlinkSetColor:\n      return isValidColor(message.color);\n    default:\n      return false;\n  }\n}\n","module.exports = require(\"lodash\");","import express, { CookieOptions } from 'express';\nconst router: express.Router = express.Router();\n\nimport bcrypt from 'bcrypt';\nimport jwt from 'jsonwebtoken';\n\nimport Config from '../../util/config';\n\nconst loginPage: string = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>blink(1) web</title>\n  </head>\n  <body>\n    <h1>Login</h1>\n    <form method=\"POST\">\n      <input name=\"password\" type=\"password\" placeholder=\"Password\">\n      <button type=\"submit\">Submit</button>\n    </form>\n  </body>\n</html>\n`;\n\n// handle login attempts before checking jwt\nrouter.post('/', express.urlencoded({ extended: true }), (req, res, next) => {\n  if (!req.body.password) {\n    res.status(400);\n    res.send(loginPage);\n    return;\n  }\n\n  bcrypt.compare(req.body.password, Config.PASSWORD_HASH, (err, same) => {\n    if (same) {\n      const token = jwt.sign({}, Config.JWT_SECRET);\n      const cookieOptions: CookieOptions = {\n        maxAge: 100 * 24 * 60 * 60 * 1000, // 100 years\n      };\n      res.cookie('jwt', token, cookieOptions);\n      res.redirect('/');\n    } else {\n      res.status(403);\n      res.send(loginPage);\n    }\n  });\n});\n\n// check jwt\nrouter.all('*', (req, res, next) => {\n  const token = req.cookies.jwt;\n  jwt.verify(token, Config.JWT_SECRET, (err: any, decoded: any) => {\n    if (err) {\n      res.status(403);\n      res.send(loginPage);\n    } else {\n      next();\n    }\n  });\n});\n\nexport default router;\n","module.exports = require(\"bcrypt\");","module.exports = require(\"jsonwebtoken\");"],"sourceRoot":""}