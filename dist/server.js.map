{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/util/config.ts","webpack:///external \"express\"","webpack:///./src/util/factory.ts","webpack:///./src/server/server.ts","webpack:///external \"cookie-parser\"","webpack:///external \"morgan\"","webpack:///external \"path\"","webpack:///external \"dotenv\"","webpack:///./src/server/routes/api.ts","webpack:///external \"node-blink1\"","webpack:///external \"pusher\"","webpack:///external \"pusher-js\"","webpack:///./src/util/message-receiver.ts","webpack:///./src/util/message-sender.ts","webpack:///./src/types/message.ts","webpack:///external \"lodash\"","webpack:///./src/server/routes/login.ts","webpack:///external \"bcrypt\"","webpack:///external \"jsonwebtoken\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__importDefault","default","config","ConfigNotSetError","_super","message","_this","this","__extends","Error","Config","getRequiredConfig","process","env","getOptionalConfig","defaultValue","e","parseInt","require","node_blink1_1","pusher_1","pusher_js_1","config_1","message_receiver_1","message_sender_1","Factory","createPusherClient","PUSHER_KEY","cluster","PUSHER_CLUSTER","encrypted","createPusherServer","appId","PUSHER_APPID","secret","PUSHER_SECRET","createBlink1","createMessageReceiver","createMessageSender","cookie_parser_1","express_1","morgan_1","path_1","api_1","login_1","app","use","json","static","join","listen","PORT","console","log","router","Router","factory_1","message_1","messageSender","post","req","res","next","isValidMessage","body","trigger","send","status","MessageReceiver","pusher","channel","subscribe","PUSHER_BLINK_CHANNEL","connection","err","error","eventName","callback","disconnect","MessageSender","pusherServer","data","subscriberConnected","path","params","statusCode","result","JSON","parse","occupied","MessageType","lodash_1","BlinkOffMessage","type","BlinkOff","BlinkSetColorMessage","color","BlinkSetColor","isObjectLike","isString","test","isValidColor","bcrypt_1","jsonwebtoken_1","loginPage","urlencoded","extended","password","compare","PASSWORD_HASH","same","token","sign","JWT_SECRET","cookie","maxAge","redirect","all","cookies","jwt","verify","decoded"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","import dotenv from 'dotenv';\ndotenv.config();\n\nclass ConfigNotSetError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'ConfigNotSetError';\n  }\n}\n\nexport default class Config {\n  private static getRequiredConfig(name: string): string {\n    if (process.env[name]) {\n      return process.env[name] as string;\n    } else {\n      throw new ConfigNotSetError(name);\n    }\n  }\n\n  private static getOptionalConfig(name: string, defaultValue?: string): string {\n    try {\n      return this.getRequiredConfig(name);\n    } catch (e) {\n      // Typescript 2.1 breaking change: instanceof Error subclass doesn't work\n      // if (e instanceof ConfigNotSetError && defaultValue) {\n      if (e.name === 'ConfigNotSetError' && defaultValue) {\n        return defaultValue;\n      }\n      throw e;\n    }\n  }\n\n  public static get PUSHER_APPID(): string { return this.getRequiredConfig('PUSHER_APPID'); }\n  public static get PUSHER_KEY(): string { return this.getRequiredConfig('PUSHER_KEY'); }\n  public static get PUSHER_SECRET(): string { return this.getRequiredConfig('PUSHER_SECRET'); }\n  public static get PUSHER_CLUSTER(): string { return this.getRequiredConfig('PUSHER_CLUSTER'); }\n  public static get PUSHER_BLINK_CHANNEL(): string { return 'blink'; }\n\n  public static get PORT(): number { return parseInt(this.getOptionalConfig('PORT', '5000')); }\n  public static get PASSWORD_HASH(): string { return this.getRequiredConfig('PASSWORD_HASH'); }\n  public static get JWT_SECRET(): string { return this.getRequiredConfig('JWT_SECRET'); }\n\n  public static get BLINK_TIMEOUT(): number { return parseInt(this.getOptionalConfig('BLINK_TIMEOUT', '30')); }\n}\n","module.exports = require(\"express\");","import Blink1 from 'node-blink1';\nimport PusherServer from 'pusher';\nimport PusherClient from 'pusher-js';\n\nimport Config from './config';\nimport MessageReceiver from './message-receiver';\nimport MessageSender from './message-sender';\n\n/* tslint:disable:member-ordering */\nexport default class Factory {\n  public static createPusherClient(): Pusher.Pusher {\n    return new PusherClient(Config.PUSHER_KEY, {\n      cluster: Config.PUSHER_CLUSTER,\n      encrypted: true,\n    });\n  }\n\n  public static createPusherServer(): PusherServer {\n    return new PusherServer({\n      appId: Config.PUSHER_APPID,\n      key: Config.PUSHER_KEY,\n      secret: Config.PUSHER_SECRET,\n      encrypted: true,\n      cluster: Config.PUSHER_CLUSTER,\n    });\n  }\n\n  public static createBlink1(): Blink1 {\n    return new Blink1();\n  }\n\n  public static createMessageReceiver(): MessageReceiver {\n    return new MessageReceiver();\n  }\n\n  public static createMessageSender(): MessageSender {\n    return new MessageSender();\n  }\n}\n","import cookieParser from 'cookie-parser';\nimport express from 'express';\nimport morgan from 'morgan';\nimport path from 'path';\n\nimport Config from '../util/config';\n\nimport api from './routes/api';\nimport login from './routes/login';\n\nconst app: express.Application = express();\n\napp.use(morgan('dev'));\napp.use(express.json());\napp.use(cookieParser());\n\napp.use('/', login);\n\n// frontend\napp.use(express.static(path.join('dist', 'www')));\n\napp.use('/api', api);\n\napp.listen(Config.PORT, () => console.log(`Listening on port ${ Config.PORT }`));\n","module.exports = require(\"cookie-parser\");","module.exports = require(\"morgan\");","module.exports = require(\"path\");","module.exports = require(\"dotenv\");","import express from 'express';\nconst router: express.Router = express.Router();\n\nimport Factory from '../../util/factory';\n\nimport {\n  isValidMessage,\n  Message,\n  MessageType,\n} from '../../types/message';\n\nimport MessageSender from '../../util/message-sender';\nconst messageSender: MessageSender = Factory.createMessageSender();\n\nrouter.post('/blink', (req: express.Request, res: express.Response, next: express.NextFunction) => {\n  if (isValidMessage(req.body)) {\n    messageSender.trigger('blink', req.body);\n    res.send();\n  } else {\n    res.status(400);\n    res.send('Invalid message');\n  }\n});\n\nexport default router;\n","module.exports = require(\"node-blink1\");","module.exports = require(\"pusher\");","module.exports = require(\"pusher-js\");","import Config from './config';\nimport Factory from './factory';\n\nexport default class MessageReceiver {\n  private pusher: Pusher.Pusher;\n  private channel: Pusher.Channel;\n\n  constructor() {\n    this.pusher = Factory.createPusherClient();\n    this.channel = this.pusher.subscribe(Config.PUSHER_BLINK_CHANNEL);\n\n    this.pusher.connection.bind('error', (err) => {\n      console.error('Pusher: connection error', err);\n    });\n  }\n\n  public bind(eventName: string, callback: Pusher.EventCallback): void {\n    this.channel.bind(eventName, callback);\n  }\n\n  public disconnect(): void {\n    this.pusher.disconnect();\n  }\n}\n","import PusherServer from 'pusher';\n\nimport Config from './config';\nimport Factory from './factory';\n\nexport default class MessageSender {\n  private pusherServer: PusherServer;\n\n  constructor() {\n    this.pusherServer = Factory.createPusherServer();\n  }\n\n  public trigger(eventName: string, data: any): void {\n    this.pusherServer.trigger(Config.PUSHER_BLINK_CHANNEL, eventName, data);\n  }\n\n  public subscriberConnected(callback: (isConnected: boolean) => void): void {\n    this.pusherServer.get({\n      path: `/channels/${Config.PUSHER_BLINK_CHANNEL}`,\n      params: {},\n    }, (err, req, res) => {\n      if (err) {\n        callback(false);\n        return;\n      }\n      if (res.statusCode === 200) {\n        const result = JSON.parse(res.body);\n        callback(result.occupied);\n      } else {\n        console.error(err);\n        callback(false);\n      }\n    });\n  }\n}\n","import _ from 'lodash';\n\nexport enum MessageType {\n  BlinkOff,\n  BlinkSetColor,\n}\n\nexport interface Message {\n  type: MessageType;\n}\n\nexport class BlinkOffMessage implements Message {\n  public type = MessageType.BlinkOff;\n\n  constructor() { }\n}\n\nexport class BlinkSetColorMessage implements Message {\n  public type = MessageType.BlinkSetColor;\n  public color: string;\n\n  constructor(color: string) {\n    this.color = color;\n  }\n}\n\n// validate format\nfunction isValidColor(color: any): boolean {\n  if (!_.isString(color)) {\n    return false;\n  }\n  const colorRegex = /^#[0-9a-f]{6}$/i;\n  return colorRegex.test(color);\n}\nexport function isValidMessage(message: any): message is Message {\n  if (!_.isObjectLike(message)) {\n    return false;\n  }\n  switch (message.type) {\n    case MessageType.BlinkOff:\n      return true;\n    case MessageType.BlinkSetColor:\n      return isValidColor(message.color);\n    default:\n      return false;\n  }\n}\n","module.exports = require(\"lodash\");","import express, { CookieOptions } from 'express';\nconst router: express.Router = express.Router();\n\nimport bcrypt from 'bcrypt';\nimport jwt from 'jsonwebtoken';\n\nimport Config from '../../util/config';\n\nconst loginPage: string = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>blink(1) web</title>\n  </head>\n  <body>\n    <h1>Login</h1>\n    <form method=\"POST\">\n      <input name=\"password\" type=\"password\" placeholder=\"Password\">\n      <button type=\"submit\">Submit</button>\n    </form>\n  </body>\n</html>\n`;\n\n// handle login attempts before checking jwt\nrouter.post('/', express.urlencoded({ extended: true }), (req, res, next) => {\n  if (!req.body.password) {\n    res.status(400);\n    res.send(loginPage);\n    return;\n  }\n\n  bcrypt.compare(req.body.password, Config.PASSWORD_HASH, (err, same) => {\n    if (same) {\n      const token = jwt.sign({}, Config.JWT_SECRET);\n      const cookieOptions: CookieOptions = {\n        maxAge: 100 * 24 * 60 * 60 * 1000, // 100 years\n      };\n      res.cookie('jwt', token, cookieOptions);\n      res.redirect('/');\n    } else {\n      res.status(403);\n      res.send(loginPage);\n    }\n  });\n});\n\n// check jwt\nrouter.all('*', (req, res, next) => {\n  const token = req.cookies.jwt;\n  jwt.verify(token, Config.JWT_SECRET, (err: any, decoded: any) => {\n    if (err) {\n      res.status(403);\n      res.send(loginPage);\n    } else {\n      next();\n    }\n  });\n});\n\nexport default router;\n","module.exports = require(\"bcrypt\");","module.exports = require(\"jsonwebtoken\");"],"sourceRoot":""}